{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/rubva/Desktop/chat+app+source+code/chat app source code/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { createUserWithEmailAndPassword, getAuth, onAuthStateChanged, sendPasswordResetEmail, signInWithEmailAndPassword } from '@angular/fire/auth';\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/auth\";\nimport * as i2 from \"./../api/api.service\";\nclass AuthService {\n  constructor(fireAuth, apiService) {\n    this.fireAuth = fireAuth;\n    this.apiService = apiService;\n    this._uid = new BehaviorSubject(null);\n  }\n  login(email, password) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        console.log(email);\n        const response = yield signInWithEmailAndPassword(_this.fireAuth, email, password);\n        console.log(response);\n        if (response?.user) {\n          _this.setUserData(response.user.uid);\n        }\n      } catch (e) {\n        console.log(e);\n        throw e;\n      }\n    })();\n  }\n  getId() {\n    const auth = getAuth();\n    console.log('current user auth: ', auth.currentUser);\n    this.currentUser = auth.currentUser;\n    console.log(this.currentUser);\n    return this.currentUser?.uid;\n  }\n  setUserData(uid) {\n    this._uid.next(uid);\n  }\n  randomIntFromInterval(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n  }\n  register(formValue) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const registeredUser = yield createUserWithEmailAndPassword(_this2.fireAuth, formValue.email, formValue.password);\n        console.log('registered user: ', registeredUser);\n        const data = {\n          email: formValue.email,\n          name: formValue.username,\n          uid: registeredUser.user.uid,\n          photo: 'https://i.pravatar.cc/' + _this2.randomIntFromInterval(200, 400)\n        };\n        yield _this2.apiService.setDocument(`users/${registeredUser.user.uid}`, data);\n        const userData = {\n          id: registeredUser.user.uid\n        };\n        return userData;\n      } catch (e) {\n        throw e;\n      }\n    })();\n  }\n  resetPassword(email) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield sendPasswordResetEmail(_this3.fireAuth, email);\n      } catch (e) {\n        throw e;\n      }\n    })();\n  }\n  logout() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this4.fireAuth.signOut();\n        _this4._uid.next(null);\n        _this4.currentUser = null;\n        return true;\n      } catch (e) {\n        throw e;\n      }\n    })();\n  }\n  checkAuth() {\n    return new Promise((resolve, reject) => {\n      onAuthStateChanged(this.fireAuth, user => {\n        console.log('auth user: ', user);\n        resolve(user);\n      });\n    });\n  }\n  getUserData(id) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const docSnap = yield _this5.apiService.getDocById(`users/${id}`);\n      if (docSnap?.exists()) {\n        return docSnap.data();\n      } else {\n        throw 'No such document exists';\n      }\n    })();\n  }\n}\n_class = AuthService;\n_class.ɵfac = function AuthService_Factory(t) {\n  return new (t || _class)(i0.ɵɵinject(i1.Auth), i0.ɵɵinject(i2.ApiService));\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport { AuthService };","map":{"version":3,"names":["createUserWithEmailAndPassword","getAuth","onAuthStateChanged","sendPasswordResetEmail","signInWithEmailAndPassword","BehaviorSubject","AuthService","constructor","fireAuth","apiService","_uid","login","email","password","_this","_asyncToGenerator","console","log","response","user","setUserData","uid","e","getId","auth","currentUser","next","randomIntFromInterval","min","max","Math","floor","random","register","formValue","_this2","registeredUser","data","name","username","photo","setDocument","userData","id","resetPassword","_this3","logout","_this4","signOut","checkAuth","Promise","resolve","reject","getUserData","_this5","docSnap","getDocById","exists","i0","ɵɵinject","i1","Auth","i2","ApiService","factory","ɵfac","providedIn"],"sources":["C:\\Users\\rubva\\Desktop\\chat+app+source+code\\chat app source code\\src\\app\\services\\auth\\auth.service.ts"],"sourcesContent":["import { ApiService } from './../api/api.service';\nimport { Injectable } from '@angular/core';\nimport { Auth, createUserWithEmailAndPassword, getAuth, onAuthStateChanged, sendPasswordResetEmail, signInWithEmailAndPassword } from '@angular/fire/auth';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n\n  public _uid = new BehaviorSubject<any>(null);\n  currentUser: any;\n\n  constructor(\n    private fireAuth: Auth,\n    private apiService: ApiService\n  ) { }\n\n  async login(email: string, password: string): Promise<any> {\n    try {\n      console.log(email);\n      const response = await signInWithEmailAndPassword(this.fireAuth, email, password);\n      console.log(response);\n      if(response?.user) {\n        this.setUserData(response.user.uid);\n      }\n    } catch(e) {\n      console.log(e);\n      throw(e);\n    }\n  }\n\n  getId() {\n    const auth = getAuth();\n    console.log('current user auth: ', auth.currentUser);\n    this.currentUser = auth.currentUser;\n    console.log(this.currentUser);\n    return this.currentUser?.uid;\n  }\n\n  setUserData(uid) {\n    this._uid.next(uid);\n  }\n\n  randomIntFromInterval(min, max) { // min and max included \n    return Math.floor(Math.random() * (max - min + 1) + min);\n  }\n\n  async register(formValue) {\n    try {\n      const registeredUser = await createUserWithEmailAndPassword(this.fireAuth, formValue.email, formValue.password);\n      console.log('registered user: ', registeredUser);\n      const data = {\n        email: formValue.email,\n        name: formValue.username,\n        uid: registeredUser.user.uid,\n        photo: 'https://i.pravatar.cc/' + this.randomIntFromInterval(200, 400)\n      };\n      await this.apiService.setDocument(`users/${registeredUser.user.uid}`, data);\n      const userData = {\n        id: registeredUser.user.uid\n      };\n      return userData;\n    } catch(e) {\n      throw(e);\n    }\n  }\n\n  async resetPassword(email: string) {\n    try {\n      await sendPasswordResetEmail(this.fireAuth, email);\n    } catch(e) {\n      throw(e);\n    }\n  }\n\n  async logout() {\n    try {\n      await this.fireAuth.signOut();\n      this._uid.next(null);\n      this.currentUser = null;\n      return true;\n    } catch(e) {\n      throw(e);\n    }\n  }\n\n  checkAuth(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      onAuthStateChanged(this.fireAuth, user => {\n        console.log('auth user: ', user);\n        resolve(user)\n      });\n    });\n  }\n\n  async getUserData(id) {\n    const docSnap: any = await this.apiService.getDocById(`users/${id}`);\n      if(docSnap?.exists()) {\n        return docSnap.data();\n      } else {\n        throw('No such document exists');\n      }\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}