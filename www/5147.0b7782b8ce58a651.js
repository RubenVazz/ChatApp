"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5147],{822:(U,v,s)=>{s.d(v,{K:()=>a});var r=s(7027),C=s(6814),d=s(6689);let a=(()=>{var g;class u{}return(g=u).\u0275fac=function(t){return new(t||g)},g.\u0275mod=d.oAB({type:g}),g.\u0275inj=d.cJS({imports:[C.ez,r.Pc]}),u})()},717:(U,v,s)=>{s.d(v,{s:()=>g});var r=s(6689),C=s(6814),d=s(7027);function a(u,P){if(1&u&&(r.TgZ(0,"ion-text")(1,"p"),r._uU(2),r.qZA()()),2&u){const t=r.oxw();r.xp6(2),r.Oqu(t.model.subTitle)}}let g=(()=>{var u;class P{constructor(){}ngOnInit(){}}return(u=P).\u0275fac=function(h){return new(h||u)},u.\u0275cmp=r.Xpm({type:u,selectors:[["app-empty-screen"]],inputs:{model:"model"},decls:9,vars:4,consts:[[1,"ion-text-center"],[3,"name","color"],[4,"ngIf"]],template:function(h,f){1&h&&(r.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",0),r._UZ(3,"ion-icon",1),r.qZA()(),r.TgZ(4,"ion-row")(5,"ion-col",0)(6,"ion-label"),r._uU(7),r.qZA(),r.YNc(8,a,3,1,"ion-text",2),r.qZA()()()),2&h&&(r.xp6(3),r.Q6J("name",null==f.model?null:f.model.icon)("color",null==f.model?null:f.model.color),r.xp6(4),r.hij(" ",null==f.model?null:f.model.title," "),r.xp6(1),r.Q6J("ngIf",null==f.model?null:f.model.subTitle))},dependencies:[C.O5,d.wI,d.jY,d.gu,d.Q$,d.Nd,d.yW],styles:["ion-grid[_ngcontent-%COMP%]{transform:translateY(10vh)}ion-grid[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18rem}"]}),P})()},5147:(U,v,s)=>{s.r(v),s.d(v,{HomePageModule:()=>Q});var r=s(822),C=s(6814),d=s(95),a=s(7027),g=s(7991),u=s(5861),P=s(8180),t=s(6689),h=s(1786),f=s(717);let A=(()=>{var e;class c{constructor(){this.onClick=new t.vpe}ngOnInit(){}redirect(){this.onClick.emit(this.item)}}return(e=c).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-user-list"]],inputs:{item:"item"},outputs:{onClick:"onClick"},decls:5,vars:2,consts:[["lines","full","detail","true",3,"click"],["slot","start"],[3,"src"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-item",0),t.NdJ("click",function(){return o.redirect()}),t.TgZ(1,"ion-avatar",1),t._UZ(2,"img",2),t.qZA(),t.TgZ(3,"ion-label"),t._uU(4),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("src",null==o.item?null:o.item.photo,t.LSH),t.xp6(2),t.hij(" ",null==o.item?null:o.item.name," "))},dependencies:[a.BJ,a.Ie,a.Q$],styles:["ion-item[_ngcontent-%COMP%]{width:90%;margin:auto;border-radius:5px;padding-bottom:1vh}"]}),c})();const m=["new_chat"],_=["popover"];function p(e,c){if(1&e){const i=t.EpF();t.TgZ(0,"ion-content",19),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.logout())}),t.TgZ(1,"ion-label",20),t._uU(2," Cerrar Sesion "),t.qZA()()}}function M(e,c){if(1&e&&t._UZ(0,"app-empty-screen",21),2&e){const i=t.oxw();t.Q6J("model",i.model)}}function y(e,c){if(1&e&&(t.ynx(0),t.TgZ(1,"ion-avatar",25),t._UZ(2,"img",26),t.qZA(),t.TgZ(3,"ion-label"),t._uU(4),t.qZA(),t.BQk()),2&e){const i=c.ngIf,n=t.oxw(4);let o,l;t.xp6(2),t.Q6J("src",null==(o=n.getUser(i))?null:o.photo,t.LSH),t.xp6(2),t.hij(" ",null==(l=n.getUser(i))?null:l.name," ")}}function T(e,c){if(1&e){const i=t.EpF();t.TgZ(0,"ion-item",24),t.NdJ("click",function(){const l=t.CHM(i).$implicit,O=t.oxw(3);return t.KtG(O.getChat(l))}),t.YNc(1,y,5,2,"ng-container",13),t.ALo(2,"async"),t.qZA()}if(2&e){const i=c.$implicit;t.Q6J("detail",!0),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,null==i?null:i.user))}}function Z(e,c){if(1&e&&(t.TgZ(0,"ion-list")(1,"ion-list-header",22),t._uU(2," RECENT CHATS "),t.qZA(),t.YNc(3,T,3,4,"ion-item",23),t.qZA()),2&e){const i=t.oxw().ngIf;t.xp6(3),t.Q6J("ngForOf",i)}}function E(e,c){if(1&e&&(t.ynx(0),t.YNc(1,Z,4,1,"ion-list",13),t.BQk()),2&e){const i=c.ngIf;t.xp6(1),t.Q6J("ngIf",(null==i?null:i.length)>0)}}function I(e,c){if(1&e){const i=t.EpF();t.TgZ(0,"app-user-list",30),t.NdJ("onClick",function(o){t.CHM(i);const l=t.oxw(3);return t.KtG(l.startChat(o))}),t.qZA()}2&e&&t.Q6J("item",c.$implicit)}function D(e,c){if(1&e&&(t.TgZ(0,"ion-content",11)(1,"ion-list",28),t.YNc(2,I,1,1,"app-user-list",29),t.qZA()()),2&e){const i=c.ngIf;t.xp6(1),t.Udp("background","transparent"),t.xp6(1),t.Q6J("ngForOf",i)}}function x(e,c){if(1&e){const i=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),t._uU(3,"New Chat"),t.qZA(),t.TgZ(4,"ion-buttons",2)(5,"ion-button",15),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.cancel())}),t._uU(6,"Cancel"),t.qZA()()()(),t.YNc(7,D,3,3,"ion-content",27),t.ALo(8,"async")}if(2&e){const i=t.oxw();t.xp6(7),t.Q6J("ngIf",t.lcZ(8,1,i.users))}}const H=[{path:"",component:(()=>{var e;class c{constructor(n,o){this.router=n,this.chatService=o,this.segment="chats",this.open_new_chat=!1,this.model={icon:"chatbubbles-outline",title:"No Chat Rooms",color:"danger"}}ngOnInit(){this.getRooms()}getRooms(){this.chatService.getChatRooms(),this.chatRooms=this.chatService.chatRooms,console.log("chatrooms: ",this.chatRooms)}logout(){var n=this;return(0,u.Z)(function*(){try{console.log("logout"),n.popover.dismiss(),yield n.chatService.auth.logout(),n.router.navigateByUrl("/login",{replaceUrl:!0})}catch(o){console.log(o)}})()}onSegmentChanged(n){console.log(n),this.segment=n.detail.value}newChat(){this.open_new_chat=!0,this.users||this.getUsers()}getUsers(){this.chatService.getUsers(),this.users=this.chatService.users}onWillDismiss(n){}cancel(){this.modal.dismiss(),this.open_new_chat=!1}startChat(n){var o=this;return(0,u.Z)(function*(){try{const l=yield o.chatService.createChatRoom(n?.uid);console.log("room: ",l),o.cancel();const O={queryParams:{name:n?.name}};o.router.navigate(["/","home","chats",l?.id],O)}catch(l){console.log(l)}})()}getChat(n){(n?.user).pipe((0,P.q)(1)).subscribe(o=>{console.log("data: ",o);const l={queryParams:{name:o?.name}};this.router.navigate(["/","home","chats",n?.id],l)})}getUser(n){return n}}return(e=c).\u0275fac=function(n){return new(n||e)(t.Y36(g.F0),t.Y36(h.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-home"]],viewQuery:function(n,o){if(1&n&&(t.Gf(m,5),t.Gf(_,5)),2&n){let l;t.iGM(l=t.CRH())&&(o.modal=l.first),t.iGM(l=t.CRH())&&(o.popover=l.first)}},decls:31,vars:8,consts:[[1,"title-header"],["color","primary"],["slot","end"],["fill","clear","id","popover"],["slot","icon-only","name","ellipsis-vertical-outline"],["trigger","popover","triggerAction","click"],["popover",""],["mode","md",3,"value","ionChange"],["value","status"],["value","chats"],["value","calls"],["color","light"],[3,"model",4,"ngIf"],[4,"ngIf"],["slot","fixed","horizontal","end","vertical","bottom"],[3,"click"],["name","add"],[3,"isOpen","willDismiss"],["new_chat",""],[1,"ion-padding","ion-text-center",3,"click"],["color","danger"],[3,"model"],["color","light",1,"ion-padding-bottom"],[3,"detail","click",4,"ngFor","ngForOf"],[3,"detail","click"],["slot","start"],[3,"src"],["color","light",4,"ngIf"],["lines","none",1,"ion-margin-top"],[3,"item","onClick",4,"ngFor","ngForOf"],[3,"item","onClick"]],template:function(n,o){if(1&n&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t._uU(3,"Chat App"),t.qZA(),t.TgZ(4,"ion-buttons",2)(5,"ion-button",3),t._UZ(6,"ion-icon",4),t.qZA()(),t.TgZ(7,"ion-popover",5,6),t.YNc(9,p,3,0,"ng-template"),t.qZA()(),t.TgZ(10,"ion-segment",7),t.NdJ("ionChange",function(O){return o.onSegmentChanged(O)}),t.TgZ(11,"ion-segment-button",8)(12,"ion-label"),t._uU(13,"Estado"),t.qZA()(),t.TgZ(14,"ion-segment-button",9)(15,"ion-label"),t._uU(16,"Chats"),t.qZA()(),t.TgZ(17,"ion-segment-button",10)(18,"ion-label"),t._uU(19,"Llamada"),t.qZA()()()(),t.TgZ(20,"ion-content",11),t.YNc(21,M,1,1,"app-empty-screen",12),t.ALo(22,"async"),t.YNc(23,E,2,1,"ng-container",13),t.ALo(24,"async"),t.TgZ(25,"ion-fab",14)(26,"ion-fab-button",15),t.NdJ("click",function(){return o.newChat()}),t._UZ(27,"ion-icon",16),t.qZA()(),t.TgZ(28,"ion-modal",17,18),t.NdJ("willDismiss",function(O){return o.onWillDismiss(O)}),t.YNc(30,x,9,3,"ng-template"),t.qZA()()),2&n){let l;t.xp6(10),t.Q6J("value",o.segment),t.xp6(11),t.Q6J("ngIf",0==(null==(l=t.lcZ(22,4,o.chatRooms))?null:l.length)),t.xp6(2),t.Q6J("ngIf","chats"==o.segment&&t.lcZ(24,6,o.chatRooms)),t.xp6(5),t.Q6J("isOpen",o.open_new_chat)}},dependencies:[C.sg,C.O5,a.BJ,a.YG,a.Sm,a.W2,a.IJ,a.W4,a.Gu,a.gu,a.Ie,a.Q$,a.q_,a.yh,a.cJ,a.GO,a.wd,a.sr,a.ki,a.d8,a.QI,f.s,A,C.Ov],styles:["ion-header.title-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{font-family:Satisfy,cursive!important}ion-header.title-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{letter-spacing:2px;font-size:1.8rem!important}ion-header.title-header[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{--background: var(--ion-color-primary)}ion-header.title-header[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{font-size:1rem;--color: var(--ion-color-light);--color-checked: #fff}ion-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}ion-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-top:2vh}ion-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1.2rem}ion-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:3px}ion-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:.9rem}"]}),c})()},{path:"chats/:id",loadChildren:()=>s.e(6332).then(s.bind(s,6332)).then(e=>e.ChatPageModule)}];let R=(()=>{var e;class c{}return(e=c).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[g.Bz.forChild(H),g.Bz]}),c})(),Q=(()=>{var e;class c{}return(e=c).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.ez,d.u5,a.Pc,R,r.K]}),c})()},1786:(U,v,s)=>{s.d(v,{a:()=>t});var r=s(5861),C=s(7398),d=s(4664),a=s(2096),g=s(6689),u=s(5175),P=s(7613);let t=(()=>{var h;class f{constructor(m,_){this.auth=m,this.api=_}getId(){console.log(this.currentUserId),this.currentUserId=this.auth.getId()}getUsers(){this.users=this.api.collectionDataQuery("users",this.api.whereQuery("uid","!=",this.currentUserId))}createChatRoom(m){var _=this;return(0,r.Z)(function*(){try{let p;if(p=yield(yield _.api.getDocs("chatRooms",_.api.whereQuery("members","in",[[m,_.currentUserId],[_.currentUserId,m]]))).docs.map(T=>{let Z=T.data();return Z.id=T.id,Z}),console.log("exist docs: ",p),p?.length>0)return p[0];const y={members:[_.currentUserId,m],type:"private",createdAt:new Date,updatedAt:new Date};return p=yield _.api.addDocument("chatRooms",y),p}catch(p){throw p}})()}getChatRooms(){this.getId(),console.log(this.currentUserId),this.chatRooms=this.api.collectionDataQuery("chatRooms",this.api.whereQuery("members","array-contains",this.currentUserId)).pipe((0,C.U)(m=>(console.log("room data: ",m),m.map(_=>{const p=_.members.filter(y=>y!=this.currentUserId);console.log(p);const M=this.api.docDataQuery(`users/${p[0]}`,!0);_.user=M}),m)),(0,d.w)(m=>(0,a.of)(m)))}getChatRoomMessages(m){this.selectedChatRoomMessages=this.api.collectionDataQuery(`chats/${m}/messages`,this.api.orderByQuery("createdAt","desc")).pipe((0,C.U)(_=>_.reverse()))}sendMessage(m,_){var p=this;return(0,r.Z)(function*(){try{const M={message:_,sender:p.currentUserId,createdAt:new Date};console.log(m),m&&(yield p.api.addDocument(`chats/${m}/messages`,M))}catch(M){throw M}})()}}return(h=f).\u0275fac=function(m){return new(m||h)(g.LFG(u.e),g.LFG(P.s))},h.\u0275prov=g.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),f})()}}]);